// Data from https://github.com/sharmadhiraj/free-json-datasets?tab=readme-ov-file  
// DO NOT MODIFY THE DATA, start your code below 
let myData = [
    {
      "language": "English(excl. creole languages)",
      "family": "Indo-European",
      "branch": "Germanic",
      "first_language_millions": "390",
      "second_language_millions": "1,138",
      "total_millions": "1,528"
    },
    {
      "language": "Mandarin Chinese(incl. Standard Chinese but excl. other varieties)",
      "family": "Sino-Tibetan",
      "branch": "Sinitic",
      "first_language_millions": "990",
      "second_language_millions": "194",
      "total_millions": "1,184"
    },
    {
      "language": "Hindi(excl. Urdu)",
      "family": "Indo-European",
      "branch": "Indo-Aryan",
      "first_language_millions": "345",
      "second_language_millions": "264",
      "total_millions": "609"
    },
    {
      "language": "Spanish(excl. creole languages)",
      "family": "Indo-European",
      "branch": "Romance",
      "first_language_millions": "484",
      "second_language_millions": "74",
      "total_millions": "558"
    },
    {
      "language": "Modern Standard Arabic(excl. dialects)",
      "family": "Afro-Asiatic",
      "branch": "Semitic",
      "first_language_millions": "0",
      "second_language_millions": "335",
      "total_millions": "335"
    },
    {
      "language": "French(excl. creole languages)",
      "family": "Indo-European",
      "branch": "Romance",
      "first_language_millions": "74",
      "second_language_millions": "238",
      "total_millions": "312"
    },
    {
      "language": "Bengali",
      "family": "Indo-European",
      "branch": "Indo-Aryan",
      "first_language_millions": "242",
      "second_language_millions": "43",
      "total_millions": "284"
    },
    {
      "language": "Portuguese(excl. creole languages)",
      "family": "Indo-European",
      "branch": "Romance",
      "first_language_millions": "250",
      "second_language_millions": "17",
      "total_millions": "267"
    },
    {
      "language": "Russian",
      "family": "Indo-European",
      "branch": "Balto-Slavic",
      "first_language_millions": "145",
      "second_language_millions": "108",
      "total_millions": "253"
    },
    {
      "language": "Indonesian",
      "family": "Austronesian",
      "branch": "Malayo-Polynesian",
      "first_language_millions": "75",
      "second_language_millions": "177",
      "total_millions": "252"
    },
    {
      "language": "Urdu(excl. Hindi)",
      "family": "Indo-European",
      "branch": "Indo-Aryan",
      "first_language_millions": "78",
      "second_language_millions": "168",
      "total_millions": "246"
    },
    {
      "language": "Standard German",
      "family": "Indo-European",
      "branch": "Germanic",
      "first_language_millions": "76",
      "second_language_millions": "58",
      "total_millions": "134"
    },
    {
      "language": "Japanese",
      "family": "Japonic",
      "branch": "—",
      "first_language_millions": "124",
      "second_language_millions": "2",
      "total_millions": "126"
    },
    {
      "language": "Nigerian Pidgin",
      "family": "English Creole",
      "branch": "Krio",
      "first_language_millions": "5",
      "second_language_millions": "116",
      "total_millions": "121"
    },
    {
      "language": "Egyptian Arabic(excl. other Arabic dialects)",
      "family": "Afro-Asiatic",
      "branch": "Semitic",
      "first_language_millions": "84",
      "second_language_millions": "35",
      "total_millions": "119"
    },
    {
      "language": "Marathi",
      "family": "Indo-European",
      "branch": "Indo-Aryan",
      "first_language_millions": "83",
      "second_language_millions": "16",
      "total_millions": "99"
    },
    {
      "language": "Vietnamese",
      "family": "Austroasiatic",
      "branch": "Vietic",
      "first_language_millions": "86",
      "second_language_millions": "11",
      "total_millions": "97"
    },
    {
      "language": "Telugu",
      "family": "Dravidian",
      "branch": "South-Central",
      "first_language_millions": "83",
      "second_language_millions": "13",
      "total_millions": "96"
    },
    {
      "language": "Hausa",
      "family": "Afro-Asiatic",
      "branch": "Chadic",
      "first_language_millions": "58",
      "second_language_millions": "36",
      "total_millions": "94"
    },
    {
      "language": "Turkish",
      "family": "Turkic",
      "branch": "Oghuz",
      "first_language_millions": "85",
      "second_language_millions": "6",
      "total_millions": "91"
    },
    {
      "language": "Western Punjabi(excl. Eastern Punjabi)",
      "family": "Indo-European",
      "branch": "Indo-Aryan",
      "first_language_millions": "—",
      "second_language_millions": "—",
      "total_millions": "90"
    },
    {
      "language": "Swahili",
      "family": "Niger–Congo",
      "branch": "Bantu",
      "first_language_millions": "4",
      "second_language_millions": "83",
      "total_millions": "87"
    },
    {
      "language": "Tagalog",
      "family": "Austronesian",
      "branch": "Malayo-Polynesian",
      "first_language_millions": "33",
      "second_language_millions": "54",
      "total_millions": "87"
    },
    {
      "language": "Tamil",
      "family": "Dravidian",
      "branch": "South",
      "first_language_millions": "79",
      "second_language_millions": "8",
      "total_millions": "86"
    },
    {
      "language": "Yue Chinese(incl. Cantonese)",
      "family": "Sino-Tibetan",
      "branch": "Sinitic",
      "first_language_millions": "85",
      "second_language_millions": "1",
      "total_millions": "86"
    },
    {
      "language": "Wu Chinese(incl. Shanghainese)",
      "family": "Sino-Tibetan",
      "branch": "Sinitic",
      "first_language_millions": "83",
      "second_language_millions": "<1",
      "total_millions": "83"
    },
    {
      "language": "Iranian Persian(excl. other Persian dialects)",
      "family": "Indo-European",
      "branch": "Iranian",
      "first_language_millions": "65",
      "second_language_millions": "17",
      "total_millions": "83"
    },
    {
      "language": "Korean",
      "family": "Koreanic",
      "branch": "—",
      "first_language_millions": "81",
      "second_language_millions": "<1",
      "total_millions": "82"
    },
    {
      "language": "Thai",
      "family": "Kra–Dai",
      "branch": "Zhuang–Tai",
      "first_language_millions": "27",
      "second_language_millions": "44",
      "total_millions": "71"
    },
    {
      "language": "Javanese",
      "family": "Austronesian",
      "branch": "Malayo-Polynesian",
      "first_language_millions": "—",
      "second_language_millions": "—",
      "total_millions": "69"
    },
    {
      "language": "Italian",
      "family": "Indo-European",
      "branch": "Romance",
      "first_language_millions": "63",
      "second_language_millions": "3",
      "total_millions": "66"
    },
    {
      "language": "Gujarati",
      "family": "Indo-European",
      "branch": "Indo-Aryan",
      "first_language_millions": "58",
      "second_language_millions": "5",
      "total_millions": "62"
    },
    {
      "language": "Levantine Arabic(excl. other Arabic dialects)",
      "family": "Afro-Asiatic",
      "branch": "Semitic",
      "first_language_millions": "58",
      "second_language_millions": "3",
      "total_millions": "60"
    },
    {
      "language": "Amharic",
      "family": "Afro-Asiatic",
      "branch": "Semitic",
      "first_language_millions": "35",
      "second_language_millions": "25",
      "total_millions": "60"
    },
    {
      "language": "Kannada",
      "family": "Dravidian",
      "branch": "South",
      "first_language_millions": "44",
      "second_language_millions": "15",
      "total_millions": "59"
    },
    {
      "language": "Bhojpuri",
      "family": "Indo-European",
      "branch": "Indo-Aryan",
      "first_language_millions": "53",
      "second_language_millions": "<1",
      "total_millions": "53"
    },
    {
      "language": "Sudanese Arabic(excl. other Arabic dialects)",
      "family": "Afro-Asiatic",
      "branch": "Semitic",
      "first_language_millions": "41",
      "second_language_millions": "11",
      "total_millions": "52"
    }
  ]

// Compute frequency of each language family
const familyCounts = d3.rollups(
  myData,
  v => v.length,
  d => d.family
);

// Convert to array of objects
const barData = familyCounts.map(d => ({
  family: d[0],
  count: d[1]
}));
barData.sort((a, b) => d3.descending(a.count, b.count));
const barwidth = 700;
const barheight = 500;
const barmargin = { top: 60, right: 30, bottom: 150, left: 70 };

const barsvg = d3.select("#bar-chart")
  .append("svg")
  .attr("width", barwidth)
  .attr("height", barheight);

const xScale = d3.scaleBand()
  .domain(barData.map(d => d.family))
  .range([barmargin.left, barwidth - barmargin.right])
  .padding(0.2);

const yScale = d3.scaleLinear()
  .domain([0, d3.max(barData, d => d.count)])
  .nice()
  .range([barheight - barmargin.bottom, barmargin.top]);

barsvg.append("g")
  .attr("transform", `translate(0,${barheight - barmargin.bottom})`)
  .call(d3.axisBottom(xScale))
  .selectAll("text")
  .attr("transform", "rotate(-45)")
  .style("text-anchor", "end");

barsvg.append("g")
  .attr("transform", `translate(${barmargin.left},0)`)
  .call(d3.axisLeft(yScale));

barsvg.selectAll("rect")
  .data(barData)
  .enter()
  .append("rect")
  .attr("x", d => xScale(d.family))
  .attr("y", d => yScale(d.count))
  .attr("width", xScale.bandwidth())
  .attr("height", d => barheight - barmargin.bottom - yScale(d.count))
  .attr("fill", "steelblue")
  .attr("rx", 6)
  .attr("ry", 6)
  .on("click", function(event, d) {
      const current = d3.select(this).attr("fill");
      d3.select(this)
        .attr("fill", current === "orange" ? "steelblue" : "orange");
  })
  .attr("y", barheight - barmargin.bottom)
  .attr("height", 0)
    .transition()
  .duration(800)
  .attr("y", d => yScale(d.count))
  .attr("height", d => barheight - barmargin.bottom - yScale(d.count));;


barsvg.append("text")
  .attr("x", barwidth / 2)
  .attr("y", barmargin.top / 2)
  .attr("text-anchor", "middle")
  .style("font-size", "20px")
  .text("Frequency of Language Families");

barsvg.append("text")
  .attr("x", barwidth / 2)
  .attr("y", barheight - 40)
  .attr("text-anchor", "middle")
  .text("Language Family");

barsvg.append("text")
  .attr("transform", "rotate(-90)")
  .attr("x", -barheight / 2)
  .attr("y", 20)
  .attr("text-anchor", "middle")
  .text("Number of Languages");

barsvg.selectAll(".domain").remove();

barsvg.selectAll(".tick line")
  .attr("stroke", "#ddd");






  
// ---------------- PIE CHART: Proportion of Language Families ----------------

// Count how many languages are in each family
// const familyCounts = d3.rollups(
//   myData,
//   v => v.length,
//   d => d.family
// );

// Convert to array for D3
const pieData = familyCounts.map(d => ({
  family: d[0],
  count: d[1]
}));

// Total number of languages
const totalLanguages = d3.sum(pieData, d => d.count);

// Pie chart size
const pieWidth = 500;
const pieHeight = 500;
const pieMargin = 50;

const radius = Math.min(pieWidth, pieHeight) / 2 - pieMargin;

// Create SVG
const pieSvg = d3.select("#pieChart")
  .append("svg")
  .attr("width", pieWidth)
  .attr("height", pieHeight);

// Title
pieSvg.append("text")
  .attr("x", pieWidth / 2)
  .attr("y", 30)
  .attr("text-anchor", "middle")
  .style("font-size", "20px")
  .text("Proportion of Languages by Family");

// Group centered for pie chart
const pieGroup = pieSvg.append("g")
  .attr("transform", `translate(${pieWidth / 2}, ${pieHeight / 2 + 20})`);

// Color scale
const color = d3.scaleOrdinal()
  .domain(pieData.map(d => d.family))
  .range(d3.schemeSet2);

// Pie generator
const pie = d3.pie()
  .value(d => d.count);

const data_ready = pie(pieData);

// Arc generator
const arc = d3.arc()
  .innerRadius(0)
  .outerRadius(radius);

// Draw slices
pieGroup.selectAll("path")
  .data(data_ready)
  .enter()
  .append("path")
  .attr("d", arc)
  .attr("fill", d => color(d.data.family))
  .attr("stroke", "black")
  .style("stroke-width", "1px")
  .style("opacity", 0.85)
  .on("click", function(event, d) {

    // proportion
    const proportion = (d.data.count / totalLanguages) * 100;

    // Update text on webpage
    d3.select("#pieInfo")
      .text(`${d.data.family}: ${proportion.toFixed(1)}% of languages (${d.data.count} total)`);

  });

const labelArc = d3.arc()
  .innerRadius(radius * 0.6)
  .outerRadius(radius * 0.6);

pieGroup.selectAll("text")
  .data(data_ready)
  .enter()
  .append("text")
  .text(d => d.data.family)
  .attr("transform", function(d) {
    const [x, y] = labelArc.centroid(d);
    const angle = (d.startAngle + d.endAngle) / 2;

    // Convert radians to degrees
    let rotate = angle * 180 / Math.PI - 90;

    return `translate(${x},${y}) rotate(${rotate})`;
  })
  .style("text-anchor", "middle")
  .style("font-size", "10px");

  //const totalLanguages = d3.sum(pieData, d => d.count);

pieGroup.selectAll("path")
  .data(data_ready)
  .enter()
  .append("path")
  .attr("d", arc)
  .attr("fill", d => color(d.data.family))
  .attr("stroke", "black")
  .style("stroke-width", "1px")
  .style("opacity", 0.85)
  .on("click", function(event, d) {

    const proportion = (d.data.count / totalLanguages) * 100;

    d3.select("#pieInfo")
      .text(`${d.data.family}: ${proportion.toFixed(1)}% (${d.data.count} languages)`);

  });


